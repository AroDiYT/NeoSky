/*

The MIT License (MIT)

Copyright (c) 2014 Juan Cazala - Lucas Bertola

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE



********************************************************************************************
                                         NODE NEURAL NETWORK
********************************************************************************************

 NODE NEURAL NETWORK is a javascript neural network library for node.js and the browser, its generalized
algorithm is architecture-free, so you can build and train basically any type of first order
or even second order neural network architectures.

http://en.wikipedia.org/wiki/Recurrent_neural_network#Second_Order_Recurrent_Neural_Network

The library includes a few built-in architectures like multilayer perceptrons, multilayer
long-short term memory networks (LSTM) or liquid state machines, and a trainer capable of
training any given network, and includes built-in training tasks/tests like solving an XOR,
passing a Distracted Sequence Recall test or an Embeded Reber Grammar test.

The algorithm implemented by this library has been taken from Derek D. Monner's paper:


A generalized LSTM-like training algorithm for second-order recurrent neural networks
http://www.overcomplete.net/papers/nn2012.pdf

There are references to the equations in that paper commented through the source code.


********************************************************************************************/
!function t(e,n,i){function r(s,a){if(!n[s]){if(!e[s]){var c="function"==typeof require&&require;if(!a&&c)return c(s,!0);if(o)return o(s,!0);var h=new Error("Cannot find module '"+s+"'");throw h.code="MODULE_NOT_FOUND",h}var u=n[s]={exports:{}};e[s][0].call(u.exports,function(t){var n=e[s][1][t];return r(n?n:t)},u,u.exports,t,e,n,i)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<i.length;s++)r(i[s]);return r}({1:[function(t,e,n){var i={Neuron:t("./neuron"),Layer:t("./layer"),Network:t("./network"),Trainer:t("./trainer"),Architect:t("./architect")};"undefined"!=typeof define&&define.amd&&define([],function(){return i}),"undefined"!=typeof e&&e.exports&&(e.exports=i),"object"==typeof window&&(!function(){var t=window.NodeNeuralNetwork;i.ninja=function(){return window.NodeNeuralNetwork=t,i}}(),window.NodeNeuralNetwork=i)},{"./architect":2,"./layer":3,"./network":4,"./neuron":5,"./trainer":6}],2:[function(t,e,n){"use strict";var i,r=t("./layer"),o=t("./network"),s=t("./trainer"),a={Perceptron:function(){var t=Array.prototype.slice.call(arguments);if(t.length<3)throw new Error("not enough layers (minimum 3) !!");var e,n,i,o=t.shift(),a=t.pop(),c=t,h=new r(o),u=[],p=new r(a),l=h;for(e in c)c.hasOwnProperty(e)&&(n=c[e],i=new r(n),u.push(i),l.project(i),l=i);l.project(p),this.set({input:h,hidden:u,output:p}),this.trainer=new s(this)},LSTM:function(){var t=Array.prototype.slice.call(arguments);if(t.length<3)throw new Error("not enough layers (minimum 3) !!");var e,n=t.pop(),i={peepholes:r.connectionType.ALL_TO_ALL,hiddenToHidden:!1,outputToHidden:!1,outputToGates:!1,inputToOutput:!0};"number"!=typeof n?(e=t.pop(),n.hasOwnProperty("peepholes")&&(i.peepholes=n.peepholes),n.hasOwnProperty("hiddenToHidden")&&(i.hiddenToHidden=n.hiddenToHidden),n.hasOwnProperty("outputToHidden")&&(i.outputToHidden=n.outputToHidden),n.hasOwnProperty("outputToGates")&&(i.outputToGates=n.outputToGates),n.hasOwnProperty("inputToOutput")&&(i.inputToOutput=n.inputToOutput)):e=n;var o,a,c,h,u,p,l,f,d,y,g=t.shift(),w=t,v=new r(g),O=[],m=new r(e),P=null;for(o in w)w.hasOwnProperty(o)&&(a=w[o],h=new r(a).set({bias:1}),c=new r(a).set({bias:1}),u=new r(a),p=new r(a).set({bias:1}),O.push(h),O.push(c),O.push(u),O.push(p),l=v.project(u),v.project(h),v.project(c),v.project(p),null!==P&&(y=P.project(u),P.project(h),P.project(c),P.project(p)),f=u.project(m),d=u.project(u),i.hiddenToHidden&&u.project(u,r.connectionType.ALL_TO_ELSE),i.outputToHidden&&m.project(u),i.outputToGates&&(m.project(h),m.project(p),m.project(c)),u.project(h,i.peepholes),u.project(c,i.peepholes),u.project(p,i.peepholes),h.gate(l,r.gateType.INPUT),c.gate(d,r.gateType.ONE_TO_ONE),p.gate(f,r.gateType.OUTPUT),null!==P&&h.gate(y,r.gateType.INPUT),P=u);i.inputToOutput&&v.project(m),this.set({input:v,hidden:O,output:m}),this.trainer=new s(this)},Liquid:function(t,e,n,i,o){var a,c,h,u,p=new r(t),l=new r(e),f=new r(n),d=l.neurons(),y=[];for(a=0;i>a;a+=1)c=Math.random()*d.length|0,h=Math.random()*d.length|0,u=d[c].project(d[h]),y.push(u);var g,w;for(g=0;o>g;g+=1)w=Math.random()*d.length|0,u=Math.random()*y.length|0,d[w].gate(y[u]);p.project(l),l.project(f),this.set({input:p,hidden:[l],output:f}),this.trainer=new s(this)},Hopfield:function(t){var e=new r(t),n=new r(t);e.project(n,r.connectionType.ALL_TO_ALL),this.set({input:e,hidden:[],output:n});var i=new s(this),o=a.Hopfield.prototype;o.learn=o.learn||function(t){var e,n=[];for(e in t)t.hasOwnProperty(e)&&n.push({input:t[e],output:t[e]});return i.train(n,{iterations:5e5,error:5e-5,rate:1})},o.feed=o.feed||function(t){var e=this.activate(t);t=[];var n;for(n in e)e.hasOwnProperty(n)&&(t[n]=e[n]>.5?1:0);return t}}};for(i in a)a.hasOwnProperty(i)&&(a[i].prototype=new o,a[i].prototype.constructor=a[i]);e&&(e.exports=a)},{"./layer":3,"./network":4,"./trainer":6}],3:[function(t,e,n){"use strict";function i(t){this.size=t||0,this.listNeurons=[],this.connectedTo=[];var e;for(e=0;e<this.size;e+=1)this.listNeurons.push(new r)}e&&(e.exports=i);var r=t("./neuron"),o=t("./network");i.prototype={activate:function(t){var e,n,i,r=[];if(void 0!==t){if(t.length!==this.size)throw new Error("INPUT size and LAYER size must be the same to activate!");for(e in this.listNeurons)this.listNeurons.hasOwnProperty(e)&&(n=this.listNeurons[e],i=n.activate(t[e]),r.push(i))}else for(e in this.listNeurons)this.listNeurons.hasOwnProperty(e)&&(n=this.listNeurons[e],i=n.activate(),r.push(i));return r},propagate:function(t,e){var n,i;if(void 0!==e){if(e.length!==this.size)throw new Error("TARGET size and LAYER size must be the same to propagate!");for(n=this.listNeurons.length-1;n>=0;n-=1)i=this.listNeurons[n],i.propagate(t,e[n])}else for(n=this.listNeurons.length-1;n>=0;n-=1)i=this.listNeurons[n],i.propagate(t)},project:function(t,e,n){if(t instanceof o&&(t=t.layers.input),!(t instanceof i))throw new Error("Invalid argument, you can only project connections to LAYERS and NETWORKS!");return this.connected(t)?void 0:new i.connection(this,t,e,n)},gate:function(t,e){var n,r,o,s,a,c;if(e===i.gateType.INPUT){if(t.to.size!==this.size)throw new Error("GATER layer and CONNECTION.TO layer must be the same size in order to gate!");for(n in t.to.listNeurons)if(t.to.listNeurons.hasOwnProperty(n)){r=t.to.listNeurons[n],o=this.listNeurons[n];for(a in r.connections.inputs)r.connections.inputs.hasOwnProperty(a)&&(s=r.connections.inputs[a],t.connections.hasOwnProperty(s.ID)&&o.gate(s))}}else if(e===i.gateType.OUTPUT){if(t.from.size!==this.size)throw new Error("GATER layer and CONNECTION.FROM layer must be the same size in order to gate!");for(n in t.from.listNeurons)if(t.from.listNeurons.hasOwnProperty(n)){r=t.from.listNeurons[n],o=this.listNeurons[n];for(c in r.connections.projected)r.connections.projected.hasOwnProperty(c)&&(s=r.connections.projected[c],t.connections.hasOwnProperty(s.ID)&&o.gate(s))}}else if(e===i.gateType.ONE_TO_ONE){if(t.size!==this.size)throw new Error("The number of GATER UNITS must be the same as the number of CONNECTIONS to gate!");for(n in t.list)t.list.hasOwnProperty(n)&&(o=this.listNeurons[n],s=t.list[n],o.gate(s))}t.gatedfrom.push({layer:this,type:e})},selfconnected:function(){var t,e;for(t in this.listNeurons)if(this.listNeurons.hasOwnProperty(t)&&(e=this.listNeurons[t],!e.selfconnected()))return!1;return!0},connected:function(t){var e,n,r,o,s,a=0;for(e in this.listNeurons)if(this.listNeurons.hasOwnProperty(e))for(s in t.listNeurons)t.listNeurons.hasOwnProperty(s)&&(n=this.listNeurons[e],r=t.listNeurons[s],o=n.connected(r),"projected"===o.type&&(a+=1));if(a===this.size*t.size)return i.connectionType.ALL_TO_ALL;a=0;var c;for(c in this.listNeurons)this.listNeurons.hasOwnProperty(c)&&(n=this.listNeurons[c],r=t.listNeurons[c],o=n.connected(r),"projected"===o.type&&(a+=1));return a===this.size?i.connectionType.ONE_TO_ONE:void 0},clear:function(){var t,e;for(t in this.listNeurons)this.listNeurons.hasOwnProperty(t)&&(e=this.listNeurons[t],e.clear())},reset:function(){var t,e;for(t in this.listNeurons)this.listNeurons.hasOwnProperty(t)&&(e=this.listNeurons[t],e.reset())},neurons:function(){return this.listNeurons},addNeuron:function(t){if(!(t instanceof r))throw new Error("Layer:addNeuron wait a neuron Object.");this.listNeurons.push(t),this.size=this.size+1},set:function(t){t=t||{};var e,n;for(e in this.listNeurons)this.listNeurons.hasOwnProperty(e)&&(n=this.listNeurons[e],t.label&&(n.label=t.label+"_"+n.ID),t.squash&&(n.squash=t.squash),t.bias&&(n.bias=t.bias));return this}},i.connection=function(t,e,n,r){this.ID=i.connection.uid(),this.from=t,this.to=e,this.selfconnection=e===t,this.type=n,this.connections={},this.list=[],this.size=0,this.gatedfrom=[];var o,s,a,c,h,u;if(void 0===this.type&&(t===e?this.type=i.connectionType.ONE_TO_ONE:this.type=i.connectionType.ALL_TO_ALL),this.type===i.connectionType.ALL_TO_ALL||this.type===i.connectionType.ALL_TO_ELSE){for(o in this.from.listNeurons)if(this.from.listNeurons.hasOwnProperty(o))for(s in this.to.listNeurons)this.to.listNeurons.hasOwnProperty(s)&&(a=this.from.listNeurons[o],c=this.to.listNeurons[s],this.type===i.connectionType.ALL_TO_ELSE&&a===c||(h=a.project(c,r),this.connections[h.ID]=h,this.size=this.list.push(h)))}else if(this.type===i.connectionType.ONE_TO_ONE)for(u in this.from.listNeurons)this.from.listNeurons.hasOwnProperty(u)&&(a=this.from.listNeurons[u],c=this.to.listNeurons[u],h=a.project(c,r),this.connections[h.ID]=h,this.size=this.list.push(h));t.connectedTo.push(this)},i.connectionType={},i.connectionType.ALL_TO_ALL="ALL TO ALL",i.connectionType.ONE_TO_ONE="ONE TO ONE",i.connectionType.ALL_TO_ELSE="ALL TO ELSE",i.gateType={},i.gateType.INPUT="INPUT",i.gateType.OUTPUT="OUTPUT",i.gateType.ONE_TO_ONE="ONE TO ONE",function(){var t=0;i.connection.uid=function(){return t+=1,t-1}}()},{"./network":4,"./neuron":5}],4:[function(t,e,n){"use strict";function i(t){void 0!==t&&(this.layers=t||{input:null,hidden:{},output:null},this.optimized=null)}e&&(e.exports=i);var r=t("./neuron"),o=t("./layer");i.prototype={activate:function(t){var e;if(this.optimized===!1){this.layers.input.activate(t);for(e in this.layers.hidden)this.layers.hidden.hasOwnProperty(e)&&this.layers.hidden[e].activate();return this.layers.output.activate()}return this.optimized||this.optimize(),this.optimized.activate(t)},propagate:function(t,e){if(this.optimized===!1){this.layers.output.propagate(t,e);var n,i=[];for(n in this.layers.hidden)this.layers.hidden.hasOwnProperty(n)&&i.push(this.layers.hidden[n]);i.reverse();for(n in i)i.hasOwnProperty(n)&&i[n].propagate(t)}else this.optimized||this.optimize(),this.optimized.propagate(t,e)},project:function(t,e,n){if(this.optimized&&this.optimized.reset(),t instanceof i)return this.layers.output.project(t.layers.input,e,n);if(t instanceof o)return this.layers.output.project(t,e,n);throw new Error("Invalid argument, you can only project connections to LAYERS and NETWORKS!")},gate:function(t,e){this.optimized&&this.optimized.reset(),this.layers.output.gate(t,e)},clear:function(){this.restore();var t=this.layers.input,e=this.layers.output;t.clear();var n,i;for(n in this.layers.hidden)this.layers.hidden.hasOwnProperty(n)&&(i=this.layers.hidden[n],i.clear());e.clear(),this.optimized&&this.optimized.reset()},reset:function(){this.restore();var t=this.layers.input,e=this.layers.output;t.reset();var n,i;for(n in this.layers.hidden)this.layers.hidden.hasOwnProperty(n)&&(i=this.layers.hidden[n],i.reset());e.reset(),this.optimized&&this.optimized.reset()},optimize:function(){var t,e,n,i=this,r={},o=this.neurons();for(t in o)if(o.hasOwnProperty(t)){for(e=o[t].neuron,n=o[t].layer;e.neuron;)e=e.neuron;r=e.optimize(r,n)}for(t in r.propagation_sentences)r.propagation_sentences.hasOwnProperty(t)&&r.propagation_sentences[t].reverse();r.propagation_sentences.reverse();var s="";s+="var F = Float64Array ? new Float64Array("+r.memory+") : []; ";for(t in r.variables)r.variables.hasOwnProperty(t)&&(s+="F["+r.variables[t].id+"] = "+(r.variables[t].value||0)+"; ");s+="var activate = function(input){\n";for(t in r.inputs)r.inputs.hasOwnProperty(t)&&(s+="F["+r.inputs[t]+"] = input["+t+"]; ");var a,c;for(a in r.activation_sentences)if(r.activation_sentences.hasOwnProperty(a)&&r.activation_sentences[a].length>0)for(c in r.activation_sentences[a])r.activation_sentences[a].hasOwnProperty(c)&&(s+=r.activation_sentences[a][c].join(" "),s+=r.trace_sentences[a][c].join(" "));s+=" var output = []; ";for(t in r.outputs)r.outputs.hasOwnProperty(t)&&(s+="output["+t+"] = F["+r.outputs[t]+"]; ");s+="return output; }; ",s+="var propagate = function(rate, target){\n",s+="F["+r.variables.rate.id+"] = rate; ";for(t in r.targets)r.targets.hasOwnProperty(t)&&(s+="F["+r.targets[t]+"] = target["+t+"]; ");for(a in r.propagation_sentences)if(r.propagation_sentences.hasOwnProperty(a))for(c in r.propagation_sentences[a])r.propagation_sentences[a].hasOwnProperty(c)&&(s+=r.propagation_sentences[a][c].join(" ")+" ");s+=" };\n",s+="var ownership = function(memoryBuffer){\nF = memoryBuffer;\nthis.memory = F;\n};\n",s+="return {\nmemory: F,\nactivate: activate,\npropagate: propagate,\nownership: ownership\n};",s=s.split(";").join(";\n");var h=new Function(s),u=h();u.data={variables:r.variables,activate:r.activation_sentences,propagate:r.propagation_sentences,trace:r.trace_sentences,inputs:r.inputs,outputs:r.outputs,check_activation:this.activate,check_propagation:this.propagate},u.reset=function(){i.optimized&&(i.optimized=null,i.activate=u.data.check_activation,i.propagate=u.data.check_propagation)},this.optimized=u,this.activate=u.activate,this.propagate=u.propagate},restore:function(){if(this.optimized){var t,e,n,i,r,o,s=this.optimized,a=function(){var t,e=Array.prototype.slice.call(arguments),n=e.shift(),i=e.pop(),r=i+"_";for(t in e)e.hasOwnProperty(t)&&(r+=e[t]+"_");r+=n.ID;var o=s.memory,a=s.data.variables;return a.hasOwnProperty(r)?o[a[r].id]:0},c=this.neurons();for(t in c)if(c.hasOwnProperty(t)){for(e=c[t].neuron;e.neuron;)e=e.neuron;e.state=a(e,"state"),e.old=a(e,"old"),e.activation=a(e,"activation"),e.bias=a(e,"bias");for(n in e.trace.elegibility)e.trace.elegibility.hasOwnProperty(n)&&(e.trace.elegibility[n]=a(e,"trace","elegibility",n));for(i in e.trace.extended)if(e.trace.extended.hasOwnProperty(i))for(n in e.trace.extended[i])e.trace.extended[i].hasOwnProperty(n)&&(e.trace.extended[i][n]=a(e,"trace","extended",i,n))}for(t in c)if(c.hasOwnProperty(t)){for(e=c[t].neuron;e.neuron;)e=e.neuron;for(r in e.connections.projected)e.connections.projected.hasOwnProperty(r)&&(o=e.connections.projected[r],o.weight=a(o,"weight"),o.gain=a(o,"gain"))}}},neurons:function(){var t,e,n,i=[],r=this.layers.input.neurons(),o=this.layers.output.neurons();for(t in r)r.hasOwnProperty(t)&&i.push({neuron:r[t],layer:"input"});for(e in this.layers.hidden)if(this.layers.hidden.hasOwnProperty(e)){n=this.layers.hidden[e].neurons();for(t in n)n.hasOwnProperty(t)&&i.push({neuron:n[t],layer:e})}for(t in o)o.hasOwnProperty(t)&&i.push({neuron:o[t],layer:"output"});return i},inputs:function(){return this.layers.input.size},outputs:function(){return this.layers.output.size},set:function(t){this.layers=t,this.optimized&&this.optimized.reset()},setOptimize:function(t){this.restore(),this.optimized&&this.optimized.reset(),this.optimized=t?null:!1},toJSON:function(){this.restore();var t,e,n,i=this.neurons(),o=[],s=[],a={};for(t in i)if(i.hasOwnProperty(t)){for(e=i[t].neuron;e.neuron;)e=e.neuron;a[e.ID]=t,n={trace:{elegibility:{},extended:{}},state:e.state,old:e.old,activation:e.activation,bias:e.bias,layer:i[t].layer},n.squash=e.squash===r.squash.LOGISTIC?"LOGISTIC":e.squash===r.squash.TANH?"TANH":e.squash===r.squash.IDENTITY?"IDENTITY":e.squash===r.squash.HLIM?"HLIM":null,o.push(n)}var c,h;for(t in i)if(i.hasOwnProperty(t)){for(e=i[t].neuron;e.neuron;)e=e.neuron;for(c in e.connections.projected)e.connections.projected.hasOwnProperty(c)&&(h=e.connections.projected[c],s.push({from:a[h.from.ID],to:a[h.to.ID],weight:h.weight,gater:h.gater?a[h.gater.ID]:null}));e.selfconnected()&&s.push({from:a[e.ID],to:a[e.ID],weight:e.selfconnection.weight,gater:e.selfconnection.gater?a[e.selfconnection.gater.ID]:null})}return{neurons:o,connections:s}},toDot:function(t){t&&void 0!==t||(t=!1);var e,n,i,r,o,s,a,c,h,u,p,l="digraph nn {\n    rankdir = BT\n",f=[this.layers.input].concat(this.layers.hidden,this.layers.output);for(e in f)if(f.hasOwnProperty(e))for(n in f[e].connectedTo)if(f[e].connectedTo.hasOwnProperty(n))if(i=f[e].connectedTo[n],r=i.to,o=i.size,s=f.indexOf(f[e]),a=f.indexOf(r),t){i.gatedfrom.length?(c="fake"+s+"_"+a,l+="    "+c+' [label = "", shape = point, width = 0.01, height = 0.01]\n',l+="    "+s+" -> "+c+" [label = "+o+", arrowhead = none]\n",l+="    "+c+" -> "+a+"\n"):l+="    "+s+" -> "+a+" [label = "+o+"]\n";for(h in i.gatedfrom)i.gatedfrom.hasOwnProperty(h)&&(u=i.gatedfrom[h].layer,p=f.indexOf(u),l+="    "+p+" -> "+c+" [color = blue]\n")}else{l+="    "+s+" -> "+a+" [label = "+o+"]\n";for(h in i.gatedfrom)i.gatedfrom.hasOwnProperty(h)&&(u=i.gatedfrom[h].layer,p=f.indexOf(u),l+="    "+p+" -> "+a+" [color = blue]\n")}return l+="}\n",{code:l,link:"https://chart.googleapis.com/chart?chl="+escape(l.replace("/ /g","+"))+"&cht=gv"}},standalone:function(){this.optimized||this.optimize();var t,e,n,i=this.optimized.data,r="function (input) {\n";for(t in i.inputs)i.inputs.hasOwnProperty(t)&&(r+="F["+i.inputs[t]+"] = input["+t+"];\n");for(e in i.activate)if(i.activate.hasOwnProperty(e))for(n in i.activate[e])i.activate[e].hasOwnProperty(n)&&(r+=i.activate[e][n].join("")+"\n");r+="var output = [];\n";for(t in i.outputs)i.outputs.hasOwnProperty(t)&&(r+="output["+t+"] = F["+i.outputs[t]+"];\n");r+="return output;\n}";var o,s,a=r.match(/F\[(\d+)\]/g),c=0,h={};for(o in a)a.hasOwnProperty(o)&&(s=a[o].match(/\d+/)[0],h.hasOwnProperty(s)||(h[s]=c,c+=1));var u="F = {\n";for(t in h)h.hasOwnProperty(t)&&(u+=h[t]+": "+this.optimized.memory[t]+",\n");return u=u.substring(0,u.length-2)+"\n};\n",u="var run = "+r.replace(/F\[(\d+)\]/g,function(t){return"F["+h[t.match(/\d+/)[0]]+"]"}).replace("{\n","{\n"+u)+";\n",u+="return run",new Function(u)()},worker:function(){this.optimized||this.optimize();var t="var inputs = "+this.optimized.data.inputs.length+";\n";t+="var outputs = "+this.optimized.data.outputs.length+";\n",t+="var F = null;\n",t+="var activate = "+this.optimized.activate.toString()+";\n",t+="var propagate = "+this.optimized.propagate.toString()+";\n",t+="onmessage = function(e){\n",t+="F = e.data.memoryBuffer;\n",t+="if (e.data.action == 'activate'){\n",t+="if (e.data.input.length == inputs){\n",t+="postMessage( { action: 'activate', output: activate(e.data.input), memoryBuffer: F }, [F.buffer]);\n",t+="}\n}\nelse if (e.data.action == 'propagate'){\n",t+="propagate(e.data.rate, e.data.target);\n",t+="postMessage({ action: 'propagate', memoryBuffer: F }, [F.buffer]);\n",t+="}\n}\n";var e=new Blob([t]),n=window.URL.createObjectURL(e);return new Worker(n)},clone:function(){return i.fromJSON(this.toJSON())}},i.fromJSON=function(t){var e,n,s,a=[],c={input:new o,hidden:[],output:new o};for(s in t.neurons)t.neurons.hasOwnProperty(s)&&(n=t.neurons[s],e=new r,e.trace.elegibility={},e.trace.extended={},e.state=n.state,e.old=n.old,e.activation=n.activation,e.bias=n.bias,e.squash=r.squash.hasOwnProperty(n.squash)?r.squash[n.squash]:r.squash.LOGISTIC,a.push(e),"input"===n.layer?c.input.addNeuron(e):"output"===n.layer?c.output.addNeuron(e):(void 0===c.hidden[n.layer]&&(c.hidden[n.layer]=new o),c.hidden[n.layer].addNeuron(e)));var h,u,p,l,f;for(s in t.connections)t.connections.hasOwnProperty(s)&&(n=t.connections[s],h=a[n.from],u=a[n.to],p=n.weight,l=a[n.gater],f=h.project(u,p),l&&l.gate(f));return new i(c)}},{"./layer":3,"./neuron":5}],5:[function(t,e,n){"use strict";function i(){this.ID=i.uid(),this.label=null,this.connections={inputs:{},projected:{},gated:{}},this.error={responsibility:0,projected:0,gated:0},this.trace={elegibility:{},extended:{},influences:{}},this.state=0,this.old=0,this.activation=0,this.selfconnection=new i.connection(this,this,0),this.squash=i.squash.LOGISTIC,this.neighboors={},this.bias=.2*Math.random()-.1}e&&(e.exports=i),i.prototype={activate:function(t){if(void 0!==t)return this.activation=t,this.derivative=0,this.bias=0,this.activation;this.old=this.state,this.state=this.selfconnection.gain*this.selfconnection.weight*this.state+this.bias;var e;for(e in this.connections.inputs)this.connections.inputs.hasOwnProperty(e)&&(t=this.connections.inputs[e],t.gater&&(this.state+=t.from.activation*t.weight*t.gain));for(e in this.connections.inputs)this.connections.inputs.hasOwnProperty(e)&&(t=this.connections.inputs[e],t.gater||(this.state+=t.from.activation*t.weight));this.activation=this.squash(this.state),this.derivative=this.squash(this.state,!0);var n,i,r,o,s,a=[];for(n in this.trace.extended)if(this.trace.extended.hasOwnProperty(n)){i=this.trace.extended[n],r=this.neighboors[n],o=r.selfconnection.gater===this?r.old:0;for(s in this.trace.influences[r.ID])this.trace.influences[r.ID].hasOwnProperty(s)&&(o+=this.trace.influences[r.ID][s].weight*this.trace.influences[r.ID][s].from.activation);a[r.ID]=o}for(e in this.connections.inputs)if(this.connections.inputs.hasOwnProperty(e)){t=this.connections.inputs[e],this.trace.elegibility[t.ID]=this.selfconnection.gain*this.selfconnection.weight*this.trace.elegibility[t.ID]+t.gain*t.from.activation;for(n in this.trace.extended)this.trace.extended.hasOwnProperty(n)&&(i=this.trace.extended[n],r=this.neighboors[n],o=a[r.ID],i[t.ID]=r.selfconnection.gain*r.selfconnection.weight*i[t.ID]+this.derivative*this.trace.elegibility[t.ID]*o)}var c;for(c in this.connections.gated)this.connections.gated.hasOwnProperty(c)&&(this.connections.gated[c].gain=this.activation);return this.activation},propagate:function(t,e){var n,i,r,o=0,s=void 0!==e;if(s)this.error.responsibility=this.error.projected=e-this.activation;else{var a;for(n in this.connections.projected)this.connections.projected.hasOwnProperty(n)&&(a=this.connections.projected[n],r=a.to,o+=r.error.responsibility*a.gain*a.weight);this.error.projected=this.derivative*o,o=0;var c;for(n in this.trace.extended)if(this.trace.extended.hasOwnProperty(n)){r=this.neighboors[n],c=r.selfconnection.gater===this?r.old:0;for(i in this.trace.influences[n])this.trace.influences[n].hasOwnProperty(i)&&(c+=this.trace.influences[n][i].weight*this.trace.influences[r.ID][i].from.activation);o+=r.error.responsibility*c}this.error.gated=this.derivative*o,this.error.responsibility=this.error.projected+this.error.gated}t=t||.1;var h;for(n in this.connections.inputs)if(this.connections.inputs.hasOwnProperty(n)){i=this.connections.inputs[n],h=this.error.projected*this.trace.elegibility[i.ID];for(n in this.trace.extended)this.trace.extended.hasOwnProperty(n)&&(r=this.neighboors[n],h+=r.error.responsibility*this.trace.extended[r.ID][i.ID]);i.weight+=t*h}this.bias+=t*this.error.responsibility},project:function(t,e){if(t===this)return this.selfconnection.weight=1,this.selfconnection;var n=this.connected(t);if(n&&"projected"===n.type)return void 0!==e&&(n.connection.weight=e),n.connection;var r=new i.connection(this,t,e);this.connections.projected[r.ID]=r,this.neighboors[t.ID]=t,t.connections.inputs[r.ID]=r,t.trace.elegibility[r.ID]=0;var o,s;for(o in t.trace.extended)t.trace.extended.hasOwnProperty(o)&&(s=t.trace.extended[o],s[r.ID]=0);return r},gate:function(t){this.connections.gated[t.ID]=t;var e,n=t.to;if(!this.trace.extended.hasOwnProperty(n.ID)){this.neighboors[n.ID]=n,e=this.trace.extended[n.ID]={};var i,r;for(i in this.connections.inputs)this.connections.inputs.hasOwnProperty(i)&&(r=this.connections.inputs[i],e[r.ID]=0)}this.trace.influences.hasOwnProperty(n.ID)?this.trace.influences[n.ID].push(t):this.trace.influences[n.ID]=[t],t.gater=this},selfconnected:function(){return 0!==this.selfconnection.weight},connected:function(t){var e={type:null,connection:!1};if(this===t)return this.selfconnected()?(e.type="selfconnection",e.connection=this.selfconnection,e):!1;var n,i;for(n in this.connections)if(this.connections.hasOwnProperty(n))for(i in this.connections[n])if(this.connections[n].hasOwnProperty(i)){if(i=this.connections[n][i],i.to===t)return e.type=n,e.connection=i,e;if(i.from===t)return e.type=n,e.connection=i,e}return!1},clear:function(){var t,e;for(t in this.trace.elegibility)this.trace.elegibility.hasOwnProperty(t)&&(this.trace.elegibility[t]=0);for(t in this.trace.extended)if(this.trace.extended.hasOwnProperty(t))for(e in this.trace.extended[t])this.trace.extended[t].hasOwnProperty(e)&&(this.trace.extended[t][e]=0);this.error.responsibility=this.error.projected=this.error.gated=0},reset:function(){this.clear();var t,e;for(t in this.connections)if(this.connections.hasOwnProperty(t))for(e in this.connections[t])this.connections[t].hasOwnProperty(e)&&(this.connections[t][e].weight=.2*Math.random()-.1);this.bias=.2*Math.random()-.1,this.old=this.state=this.activation=0},optimize:function(t,e){t=t||{};var n,r,o,s,a,c,h,u,p,l,f,d,y,g,w,v,O,m,P,T=[],N=[],I=[],b=t.memory||0,D=t.neurons||1,_=t.inputs||[],E=t.targets||[],z=t.outputs||[],j=t.variables||{},x=t.activation_sentences||[],L=t.trace_sentences||[],M=t.propagation_sentences||[],S=t.layers||{__count:0,__neuron:0},A=function(t){var n=S.hasOwnProperty(e)&&t[S.__count];n||(S.__count=t.push([])-1,S[e]=S.__count)};A(x),A(L),A(M);var k,q=S.__count,F=function(){var t,e=Array.prototype.slice.call(arguments);if(1===e.length)return"target"===e[0]?(t="target_"+E.length,E.push(b)):t=e[0],j.hasOwnProperty(t)?j[t]:(b+=1,j[t]={value:0,id:b-1},j[t]);var n,i=e.length>2;i&&(n=e.pop());var r=e.shift(),o=e.pop();i||(n=r[o]),t=o+"_";var s;for(s in e)e.hasOwnProperty(s)&&(t+=e[s]+"_");return t+=r.ID,j.hasOwnProperty(t)?j[t]:(b+=1,j[t]={value:n,id:b-1},j[t])},R=function(){var t,e=Array.prototype.slice.call(arguments),n=e.pop(),i="";for(t in e)e.hasOwnProperty(t)&&(i+="string"==typeof e[t]?e[t]:"F["+e[t].id+"]");n.push(i+";")},H=function(t){var e;for(e in t)if(t.hasOwnProperty(e))return!1;return!0},U=H(this.connections.projected),C=H(this.connections.gated),G="input"===e?!0:H(this.connections.inputs),B="output"===e?!0:U&&C,V=F("rate"),Y=F(this,"activation");if(G)_.push(Y.id);else{x[q].push(T),L[q].push(N),M[q].push(I);var J=F(this,"old"),X=F(this,"state");p=F(this,"bias");var W;this.selfconnection.gater&&(W=F(this.selfconnection,"gain"));var K;this.selfconnected()&&(K=F(this.selfconnection,"weight")),R(J," = ",X,T),this.selfconnected()?this.selfconnection.gater?R(X," = ",W," * ",K," * ",X," + ",p,T):R(X," = ",K," * ",X," + ",p,T):R(X," = ",p,T);var Q,Z,$;for(Q in this.connections.inputs)this.connections.inputs.hasOwnProperty(Q)&&(n=this.connections.inputs[Q],Z=F(n.from,"activation"),P=F(n,"weight"),n.gater?($=F(n,"gain"),R(X," += ",Z," * ",P," * ",$,T)):R(X," += ",Z," * ",P,T));switch(s=F(this,"derivative"),this.squash){case i.squash.LOGISTIC:R(Y," = (1 / (1 + Math.exp(-",X,")))",T),R(s," = ",Y," * (1 - ",Y,")",T);break;case i.squash.TANH:var tt=F("aux"),et=F("aux_2");R(tt," = Math.exp(",X,")",T),R(et," = 1 / ",tt,T),R(Y," = (",tt," - ",et,") / (",tt," + ",et,")",T),R(s," = 1 - (",Y," * ",Y,")",T);break;case i.squash.IDENTITY:R(Y," = ",X,T),R(s," = 1",T);break;case i.squash.HLIM:R(Y," = +(",X," > 0)",T),R(s," = 1",T);break;case i.squash.RELU:R(Y," = ",X," > 0 ? ",X," : 0",T),R(s," = ",X," > 0 ? 1 : 0",T)}for(k in this.trace.extended)if(this.trace.extended.hasOwnProperty(k)){c=this.trace.extended[k],v=this.neighboors[k],h=F("influences["+v.ID+"]"),u=F(v,"old"),l=!1,v.selfconnection.gater===this&&(R(h," = ",u,N),l=!0);for(f in this.trace.influences[v.ID])this.trace.influences[v.ID].hasOwnProperty(f)&&(d=F(this.trace.influences[v.ID][f],"weight"),y=F(this.trace.influences[v.ID][f].from,"activation"),l?R(h," += ",d," * ",y,N):(R(h," = ",d," * ",y,N),l=!0))}var nt,it;for(Q in this.connections.inputs)if(this.connections.inputs.hasOwnProperty(Q)){n=this.connections.inputs[Q],n.gater&&($=F(n,"gain")),Z=F(n.from,"activation"),o=F(this,"trace","elegibility",n.ID,this.trace.elegibility[n.ID]),this.selfconnected()?this.selfconnection.gater?n.gater?R(o," = ",W," * ",K," * ",o," + ",$," * ",Z,N):R(o," = ",W," * ",K," * ",o," + ",Z,N):n.gater?R(o," = ",K," * ",o," + ",$," * ",Z,N):R(o," = ",K," * ",o," + ",Z,N):n.gater?R(o," = ",$," * ",Z,N):R(o," = ",Z,N);for(k in this.trace.extended)this.trace.extended.hasOwnProperty(k)&&(c=this.trace.extended[k],v=this.neighboors[k],h=F("influences["+v.ID+"]"),u=F(v,"old"),o=F(this,"trace","elegibility",n.ID,this.trace.elegibility[n.ID]),c=F(this,"trace","extended",v.ID,n.ID,this.trace.extended[v.ID][n.ID]),v.selfconnected()&&(nt=F(v.selfconnection,"weight")),v.selfconnection.gater&&(it=F(v.selfconnection,"gain")),v.selfconnected()?v.selfconnection.gater?R(c," = ",it," * ",nt," * ",c," + ",s," * ",o," * ",h,N):R(c," = ",nt," * ",c," + ",s," * ",o," * ",h,N):R(c," = ",s," * ",o," * ",h,N))}var rt;for(w in this.connections.gated)this.connections.gated.hasOwnProperty(w)&&(rt=F(this.connections.gated[w],"gain"),R(rt," = ",Y,T))}if(!G){var ot=F(this,"error","responsibility",this.error.responsibility);if(B){var st=F("target");R(ot," = ",st," - ",Y,I);for(k in this.connections.inputs)this.connections.inputs.hasOwnProperty(k)&&(n=this.connections.inputs[k],o=F(this,"trace","elegibility",n.ID,this.trace.elegibility[n.ID]),P=F(n,"weight"),R(P," += ",V," * (",ot," * ",o,")",I));z.push(Y.id)}else if(U||C){if(C){R(ot," = 0",I);for(k in this.connections.projected)this.connections.projected.hasOwnProperty(k)&&(w=this.connections.projected[k],v=w.to,m=F(w,"weight"),r=F(v,"error","responsibility",v.error.responsibility),w.gater?(g=F(w,"gain"),R(ot," += ",r," * ",g," * ",m,I)):R(ot," += ",r," * ",m,I));R(ot," *= ",s,I);for(k in this.connections.inputs)this.connections.inputs.hasOwnProperty(k)&&(n=this.connections.inputs[k],o=F(this,"trace","elegibility",n.ID,this.trace.elegibility[n.ID]),P=F(n,"weight"),R(P," += ",V," * (",ot," * ",o,")",I))}else if(U){R(ot," = 0",I);for(k in this.trace.extended)if(this.trace.extended.hasOwnProperty(k)){v=this.neighboors[k],h=F("aux"),u=F(v,"old"),v.selfconnection.gater===this?R(h," = ",u,I):R(h," = 0",I);for(n in this.trace.influences[v.ID])this.trace.influences[v.ID].hasOwnProperty(n)&&(w=this.trace.influences[v.ID][n],m=F(w,"weight"),O=F(w.from,"activation"),R(h," += ",m," * ",O,I));r=F(v,"error","responsibility",v.error.responsibility),R(ot," += ",r," * ",h,I)}R(ot," *= ",s,I);for(k in this.connections.inputs)if(this.connections.inputs.hasOwnProperty(k)){n=this.connections.inputs[k],a=F("aux"),R(a," = 0",I);for(k in this.trace.extended)this.trace.extended.hasOwnProperty(k)&&(v=this.neighboors[k],r=F(v,"error","responsibility",v.error.responsibility),c=F(this,"trace","extended",v.ID,n.ID,this.trace.extended[v.ID][n.ID]),R(a," += ",r," * ",c,I));P=F(n,"weight"),R(P," += ",V," * ",a,I)}}}else{var at=F("aux");for(k in this.connections.projected)this.connections.projected.hasOwnProperty(k)&&(w=this.connections.projected[k],v=w.to,m=F(w,"weight"),r=F(v,"error","responsibility",v.error.responsibility),w.gater?(g=F(w,"gain"),R(at," += ",r," * ",g," * ",m,I)):R(at," += ",r," * ",m,I));var ct=F(this,"error","projected",this.error.projected);R(ct," = ",s," * ",at,I),R(at," = 0",I);for(k in this.trace.extended)if(this.trace.extended.hasOwnProperty(k)){v=this.neighboors[k],h=F("aux_2"),u=F(v,"old"),v.selfconnection.gater===this?R(h," = ",u,I):R(h," = 0",I);for(n in this.trace.influences[v.ID])this.trace.influences[v.ID].hasOwnProperty(n)&&(w=this.trace.influences[v.ID][n],m=F(w,"weight"),O=F(w.from,"activation"),R(h," += ",m," * ",O,I));r=F(v,"error","responsibility",v.error.responsibility),R(at," += ",r," * ",h,I)}var ht=F(this,"error","gated",this.error.gated);R(ht," = ",s," * ",at,I),R(ot," = ",ct," + ",ht,I);for(k in this.connections.inputs)if(this.connections.inputs.hasOwnProperty(k)){n=this.connections.inputs[k],a=F("aux"),o=F(this,"trace","elegibility",n.ID,this.trace.elegibility[n.ID]),R(a," = ",ct," * ",o,I);for(k in this.trace.extended)this.trace.extended.hasOwnProperty(k)&&(v=this.neighboors[k],r=F(v,"error","responsibility",v.error.responsibility),c=F(this,"trace","extended",v.ID,n.ID,this.trace.extended[v.ID][n.ID]),R(a," += ",r," * ",c,I));P=F(n,"weight"),R(P," += ",V," * ",a,I)}}R(p," += ",V," * ",ot,I)}return{memory:b,neurons:D+1,inputs:_,outputs:z,targets:E,variables:j,activation_sentences:x,trace_sentences:L,propagation_sentences:M,layers:S}}},i.connection=function(t,e,n){if(!t||!e)throw new Error("Connection Error: Invalid neurons");this.ID=i.connection.uid(),this.from=t,this.to=e,this.weight=void 0===n?.2*Math.random()-.1:n,this.gain=1,this.gater=null},i.squash={},i.squash.LOGISTIC=function(t,e){if(!e)return 1/(1+Math.exp(-t));var n=i.squash.LOGISTIC(t);return n*(1-n)},i.squash.TANH=function(t,e){if(e)return 1-Math.pow(i.squash.TANH(t),2);var n=Math.exp(t),r=1/n;return(n-r)/(n+r)},i.squash.IDENTITY=function(t,e){return e?1:t},i.squash.HLIM=function(t,e){return e?1:t>0?1:0},i.squash.RELU=function(t,e){return e?t>0?1:0:t>0?t:0},function(){
var t=0,e=0;i.uid=function(){return t+=1,t-1},i.connection.uid=function(){return e+=1,e-1},i.quantity=function(){return{neurons:t,connections:e}}}()},{}],6:[function(t,e,n){"use strict";function i(t,e){e=e||{},this.network=t,this.rate=e.rate||.2,this.iterations=e.iterations||1e5,this.error=e.error||.005,this.cost=e.cost||null,this.crossValidate=e.crossValidate||null}e&&(e.exports=i),i.prototype={train:function(t,e){function n(t){var e,n,i,r=0;for(i=t.length;i;e=Math.floor(Math.random()*i),i-=1,n=t[i],t[i]=t[e],t[e]=n)r+=1;return t}var r,o,s=1,a=0,c=0,h=!1;e&&e.cost?o=e.cost:this.cost?o=this.cost:i.cost.MSE&&(o=i.cost.MSE);var u,p,l=!1,f=Date.now();if(e&&(e.iterations&&(this.iterations=e.iterations),e.error&&(this.error=e.error),e.rate&&(this.rate=e.rate),e.cost&&(this.cost=e.cost),e.schedule&&(this.schedule=e.schedule),e.customLog&&(console.log("Deprecated: use schedule instead of customLog"),this.schedule=e.customLog),this.crossValidate&&(l=!0,e.crossValidate.testSize&&(this.crossValidate.testSize=e.crossValidate.testSize),e.crossValidate.testError&&(this.crossValidate.testError=e.crossValidate.testError))),r=this.rate,Array.isArray(this.rate)&&(a=Math.floor(this.iterations/this.rate.length)),l){var d=Math.ceil((1-this.crossValidate.testSize)*t.length);p=t.slice(0,d),u=t.slice(d)}for(var y,g;!h&&c<this.iterations&&s>this.error&&!(l&&s<=this.crossValidate.testError);)y=t.length,s=0,a>0&&(g=Math.floor(c/a),r=this.rate[g]||r),l?(this.trainSet(p,r,o),s+=this.test(u).error,y=1):(s+=this.trainSet(t,r,o),y=t.length),c+=1,s/=y,e&&(this.schedule&&this.schedule.every&&c%this.schedule.every===0?h=this.schedule["do"]({error:s,iterations:c,rate:r}):e.log&&c%e.log===0&&console.log("iterations",c,"error",s,"rate",r),e.shuffle&&n(t));var w={error:s,iterations:c,time:Date.now()-f};return w},trainSet:function(t,e,n){var i,r,o,s,a=0;for(s in t)t.hasOwnProperty(s)&&(i=t[s].input,r=t[s].output,o=this.network.activate(i),this.network.propagate(e,r),a+=n(r,o));return a},test:function(t,e){var n,r,o,s,a=0;e&&e.cost?s=e.cost:this.cost?s=this.cost:i.cost.MSE&&(s=i.cost.MSE);var c,h=Date.now();for(c in t)t.hasOwnProperty(c)&&(n=t[c].input,o=t[c].output,r=this.network.activate(n),a+=s(o,r));a/=t.length;var u={error:a,time:Date.now()-h};return u},workerTrain:function(t,e,n){function r(t){var e,n,i,r;for(r=0,i=t.length;i;e=Math.floor(Math.random()*i),i-=1,n=t[i],t[i]=t[e],t[e]=n)r+=1;return t}function o(t){w.postMessage({action:"activate",input:t,memoryBuffer:h.network.optimized.memory},[h.network.optimized.memory.buffer])}function s(t){if(p>0){var e=Math.floor(l/p);a=h.rate[e]||a}w.postMessage({action:"propagate",target:t,rate:a,memoryBuffer:h.network.optimized.memory},[h.network.optimized.memory.buffer])}var a,c,h=this,u=1,p=0,l=0,f=t.length,d=!1;n&&n.cost?c=n.cost:this.cost?c=this.cost:i.cost.MSE&&(c=i.cost.MSE);var y=Date.now();n&&(n.iterations&&(h.iterations=n.iterations),n.error&&(h.error=n.error),n.rate&&(h.rate=n.rate),n.cost&&(h.cost=n.cost),n.schedule&&(h.schedule=n.schedule),n.customLog&&(console.log("Deprecated: use schedule instead of customLog"),h.schedule=n.customLog)),a=h.rate,Array.isArray(h.rate)&&(p=Math.floor(h.iterations/h.rate.length));var g,w=h.network.worker();w.onmessage=function(i){h.network.optimized.ownership(i.data.memoryBuffer),"propagate"===i.data.action&&(g>=f?(g=0,l+=1,u/=t.length,n&&(h.schedule&&h.schedule.every&&l%h.schedule.every===0?d=h.schedule["do"]({error:u,iterations:l,rate:a}):n.log&&l%n.log===0&&console.log("iterations",l,"error",u),n.shuffle&&r(t)),!d&&l<h.iterations&&u>h.error?o(t[g].input):e({error:u,iterations:l,time:Date.now()-y}),u=0):o(t[g].input)),"activate"===i.data.action&&(u+=c(t[g].output,i.data.output),s(t[g].output),g+=1)},g=0,o(t[g].input)},XOR:function(t){if(2!==this.network.inputs()||1!==this.network.outputs())throw new Error("Incompatible network (2 inputs, 1 output)");var e={iterations:1e5,log:!1,shuffle:!0,cost:i.cost.MSE};if(t){var n;for(n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}return this.train([{input:[0,0],output:[0]},{input:[1,0],output:[1]},{input:[0,1],output:[1]},{input:[1,1],output:[0]}],e)},DSR:function(t){t=t||{};for(var e,n,r,o,s,a,c,h,u,p,l,f,d=t.targets||[2,4,7,8],y=t.distractors||[3,5,6,9],g=t.prompts||[0,1],w=t.length||24,v=t.success||.95,O=t.iterations||1e5,m=t.rate||.1,P=t.log||0,T=t.schedule||{},N=t.cost||this.cost||i.cost.CROSS_ENTROPY,I=0,b=0,D=0,_=0,E=0,z=1,j=d.length+y.length+g.length,x=function(t,e){var n,i=Math.random()*t|0,r=!1;for(n in e)e.hasOwnProperty(n)&&i===e[n]&&(r=!0);return r?x(t,e):i},L=function(t,e){var n;for(n in t)if(t.hasOwnProperty(n)&&Math.round(t[n])!==e[n])return!1;return!0},M=Date.now();O>E&&(v>I||E%1e3!==0);){for(e=[],n=w-g.length,D=0;n>D;D+=1)r=Math.random()*y.length|0,e.push(y[r]);for(o=[],s=[],D=0;D<g.length;D+=1)o.push(Math.random()*d.length|0),s.push(x(n,s));for(s=s.sort(),D=0;D<g.length;D+=1)e[s[D]]=d[o[D]],e.push(g[D]);for(c=0,a=0,z=0,D=0;w>D;D+=1){for(h=[],b=0;j>b;b+=1)h[b]=0;for(h[e[D]]=1,u=[],b=0;b<d.length;b+=1)u[b]=0;D>=n&&(p=D-n,u[o[p]]=1),l=this.network.activate(h),L(l,u)?n>D?a+=1:c+=1:this.network.propagate(m,u),z+=N(u,l),a+c===w&&(_+=1)}E%1e3===0&&(_=0),E+=1,f=E%1e3,f=0===f?1e3:f,I=_/f,z/=w,P&&E%P===0&&console.log("iterations:",E," success:",I," correct:",_," time:",Date.now()-M," error:",z),T["do"]&&T.every&&E%T.every===0&&T["do"]({iterations:E,success:I,error:z,time:Date.now()-M,correct:_})}return{iterations:E,success:I,error:z,time:Date.now()-M}},ERG:function(t){t=t||{};var e=t.iterations||15e4,n=t.error||.05,r=t.rate||.1,o=t.log||500,s=t.cost||this.cost||i.cost.CROSS_ENTROPY,a=function(){this.paths=[]};a.prototype={connect:function(t,e){return this.paths.push({node:t,value:e}),this},any:function(){if(0===this.paths.length)return!1;var t=Math.random()*this.paths.length|0;return this.paths[t]},test:function(t){var e;for(e in this.paths)if(this.paths.hasOwnProperty(e)&&this.paths[e].value===t)return this.paths[e];return!1}};for(var c,h,u,p,l,f,d,y,g=function(){var t=new a,e=(new a).connect(t,"E"),n=(new a).connect(e,"S"),i=(new a).connect(e,"V").connect(n,"P"),r=(new a).connect(n,"X");r.connect(r,"S");var o=(new a).connect(i,"V");o.connect(o,"T"),n.connect(o,"X");var s=(new a).connect(r,"T").connect(o,"P"),c=(new a).connect(s,"B");return{input:c,output:t}},w=function(){var t=g(),e=g(),n=new a,i=(new a).connect(n,"E");t.output.connect(i,"T"),e.output.connect(i,"P");var r=(new a).connect(t.input,"P").connect(e.input,"T"),o=(new a).connect(r,"B");return{input:o,output:n}},v=function(){for(var t=w().input,e=t.any(),n="";e;)n+=e.value,e=e.node.any();return n},O=function(t){for(var e,n=w().input,i=0,r=t.charAt(i);i<t.length;){if(e=n.test(r),!e)return!1;n=e.node,i+=1,r=t.charAt(i)}return!0},m=function(t,e){var n,i=0,r=-1,o=0,s=-1;for(n in t)t.hasOwnProperty(n)&&(t[n]>i&&(i=t[n],r=n),e[n]>o&&(o=e[n],s=n));return r!==s},P=0,T=1,N={B:0,P:1,T:2,X:3,S:4,E:5},I=Date.now();e>P&&T>n;){for(c=0,T=0,h=v(),u=h.charAt(c),p=h.charAt(c+1);c<h.length-1;){for(l=[],f=[],d=0;6>d;d+=1)l[d]=0,f[d]=0;l[N[u]]=1,f[N[p]]=1,y=this.network.activate(l),m(y,f)&&this.network.propagate(r,f),c+=1,u=h.charAt(c),p=h.charAt(c+1),T+=s(f,y)}T/=h.length,P+=1,P%o===0&&console.log("iterations:",P," time:",Date.now()-I," error:",T)}return{iterations:P,error:T,time:Date.now()-I,test:O,generate:v}},timingTask:function(t){function e(t,e){var n,i=t+e,r=0,o=[];for(n=0;i>n;n+=1)o.push({input:[0,0],output:[0]});for(var s,a,c;i-20>r;){for(s=Math.round(20*Math.random()),o[r].input[0]=1,a=r;r+s>=a;a+=1)o[a].input[1]=s/20,o[a].output[0]=.5;for(r+=s,s=Math.round(20*Math.random()),c=r+1;r+s>=c&&i>c;c+=1)o[c].input[1]=o[r].input[1];r+=s}var h,u=[],p=[];for(h=0;i>h;h+=1)(t>h?u:p).push(o[h]);return{train:u,test:p}}if(2!==this.network.inputs()||1!==this.network.outputs())throw new Error("Invalid Network: must have 2 inputs and one output");void 0===t&&(t={});var n=t.iterations||200,r=t.error||.005,o=t.rate||[.03,.02],s=t.log===!1?!1:t.log||10,a=t.cost||this.cost||i.cost.MSE,c=t.trainSamples||7e3,h=t.trainSamples||1e3,u=e(c,h),p=this.train(u.train,{rate:o,log:s,iterations:n,error:r,cost:a});return{train:p,test:this.test(u.test)}}},i.cost={CROSS_ENTROPY:function(t,e){var n,i=0;for(n in e)e.hasOwnProperty(n)&&(i-=t[n]*Math.log(e[n]+1e-15)+(1-t[n])*Math.log(1+1e-15-e[n]));return i},MSE:function(t,e){var n,i=0;for(n in e)e.hasOwnProperty(n)&&(i+=Math.pow(t[n]-e[n],2));return i/e.length},BINARY:function(t,e){var n,i=0;for(n in e)e.hasOwnProperty(n)&&(i+=Math.round(2*t[n])!==Math.round(2*e[n]));return i}}},{}]},{},[1]);var Neuron = NodeNeuralNetwork.Neuron, Layer = NodeNeuralNetwork.Layer, Network = NodeNeuralNetwork.Network, Trainer = NodeNeuralNetwork.Trainer, Architect = NodeNeuralNetwork.Architect;